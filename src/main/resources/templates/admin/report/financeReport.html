<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ParQHub - Financial Report</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #0a0f1c; }
        .glass {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        .active {
            background: linear-gradient(90deg, #ffb703, #ff6600);
            color: #0a0f1c !important;
            font-weight: bold;
        }
    </style>
</head>
<body class="text-white flex">

<!-- Sidebar -->
<aside class="w-72 h-screen glass flex flex-col fixed">
    <div class="p-6 flex items-center gap-3 border-b border-gray-700">
        <img src="/images/logo.svg" alt="ParQHub" class="h-10">
        <span class="text-2xl font-bold">ParQHub</span>
    </div>
    <nav class="flex-1 p-4 space-y-2">
        <a href="/admin/dashboard" class="flex items-center gap-3 p-3 rounded-lg hover:bg-yellow-400/30 transition"><i class="fas fa-home"></i> Dashboard</a>
        <a href="/admin/tables" class="flex items-center gap-3 p-3 rounded-lg hover:bg-yellow-400/30 transition"><i class="fas fa-table"></i> Table View</a>
        <a href="/admin/parking-viewer" class="flex items-center gap-3 p-3 rounded-lg hover:bg-yellow-400/30 transition"><i class="fas fa-parking"></i> Parking Viewer</a>
        <a href="/admin/reports" class="flex items-center gap-3 p-3 rounded-lg hover:bg-yellow-400/30 transition"><i class="fas fa-chart-bar"></i> Report View</a>
    </nav>
    <div class="p-4 border-t border-gray-700">
        <a th:href="@{/admin/logout}" class="flex items-center gap-3 p-3 rounded-lg hover:bg-red-500/30 text-red-400"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </div>
</aside>

<!-- Main Content -->
<main class="ml-72 w-full p-6">
    <!-- Top bar -->
    <div class="flex justify-between items-center mb-6">
        <div class="flex items-center gap-4">
            <a href="/admin/reports" class="text-yellow-400 hover:text-yellow-300 transition">
                <i class="fas fa-arrow-left text-xl"></i>
            </a>
            <h1 class="text-2xl font-bold">Financial Report</h1>
        </div>
        <div class="flex items-center gap-4">
            <button onclick="exportReport()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-400 transition font-semibold">
                <i class="fas fa-download mr-2"></i>Export PDF
            </button>
            <button onclick="refreshReport()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-400 transition font-semibold">
                <i class="fas fa-sync-alt mr-2"></i>Refresh
            </button>
            <span class="text-gray-300">Welcome, <span th:text="${adminName}">Admin</span></span>
        </div>
    </div>

    <!-- Report Period Selection -->
    <div class="glass p-6 rounded-lg mb-6">
        <h2 class="text-xl font-bold mb-4">Report Period</h2>
        <div class="flex gap-4 items-end">
            <div>
                <label for="startDate" class="block text-sm font-medium text-gray-300 mb-2">Start Date</label>
                <input type="date" id="startDate" class="bg-gray-700/50 border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:border-yellow-400">
            </div>
            <div>
                <label for="endDate" class="block text-sm font-medium text-gray-300 mb-2">End Date</label>
                <input type="date" id="endDate" class="bg-gray-700/50 border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:border-yellow-400">
            </div>
            <button onclick="generateReport()" class="bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-400 transition font-semibold">
                <i class="fas fa-chart-bar mr-2"></i>Generate Report
            </button>
        </div>
    </div>

    <!-- Financial Summary -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
        <div class="glass p-6 rounded-lg text-center">
            <div class="text-3xl font-bold text-green-400 mb-2" id="totalRevenue">$12,450</div>
            <div class="text-sm text-gray-400">Total Revenue</div>
        </div>
        <div class="glass p-6 rounded-lg text-center">
            <div class="text-3xl font-bold text-blue-400 mb-2" id="totalPayments">1,247</div>
            <div class="text-sm text-gray-400">Total Payments</div>
        </div>
        <div class="glass p-6 rounded-lg text-center">
            <div class="text-3xl font-bold text-purple-400 mb-2" id="avgPayment">$9.98</div>
            <div class="text-sm text-gray-400">Avg Payment</div>
        </div>
        <div class="glass p-6 rounded-lg text-center">
            <div class="text-3xl font-bold text-yellow-400 mb-2" id="pendingAmount">$450</div>
            <div class="text-sm text-gray-400">Pending Amount</div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <!-- Revenue Chart -->
        <div class="glass p-6 rounded-lg">
            <h3 class="text-lg font-bold mb-4">Revenue Trend</h3>
            <canvas id="revenueChart" width="400" height="200"></canvas>
        </div>

        <!-- Payment Methods Chart -->
        <div class="glass p-6 rounded-lg">
            <h3 class="text-lg font-bold mb-4">Payment Methods</h3>
            <canvas id="paymentMethodsChart" width="400" height="200"></canvas>
        </div>
    </div>

    <!-- Payment Status Chart -->
    <div class="glass p-6 rounded-lg mb-6">
        <h3 class="text-lg font-bold mb-4">Payment Status Distribution</h3>
        <canvas id="paymentStatusChart" width="800" height="300"></canvas>
    </div>

    <!-- Recent Transactions -->
    <div class="glass p-6 rounded-lg">
        <h3 class="text-lg font-bold mb-4">Recent Transactions</h3>
        <div class="overflow-x-auto">
            <table class="w-full text-sm">
                <thead>
                    <tr class="border-b border-gray-600">
                        <th class="text-left py-3 px-4">Transaction ID</th>
                        <th class="text-left py-3 px-4">User</th>
                        <th class="text-left py-3 px-4">Amount</th>
                        <th class="text-left py-3 px-4">Method</th>
                        <th class="text-left py-3 px-4">Status</th>
                        <th class="text-left py-3 px-4">Date</th>
                    </tr>
                </thead>
                <tbody id="transactionsTable">
                    <!-- Transactions will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>
</main>

<script>
// Initialize charts
document.addEventListener('DOMContentLoaded', function() {
    initializeCharts();
    loadRecentTransactions();
    setDefaultDates();
});

function setDefaultDates() {
    const today = new Date();
    const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());
    
    document.getElementById('startDate').value = lastMonth.toISOString().split('T')[0];
    document.getElementById('endDate').value = today.toISOString().split('T')[0];
}

function initializeCharts() {
    // Revenue Chart
    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
    new Chart(revenueCtx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            datasets: [{
                label: 'Revenue ($)',
                data: [2000, 2500, 1800, 3200, 2800, 3500],
                borderColor: '#10b981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    labels: { color: '#ffffff' }
                }
            },
            scales: {
                x: { ticks: { color: '#ffffff' } },
                y: { ticks: { color: '#ffffff' } }
            }
        }
    });

    // Payment Methods Chart
    const paymentMethodsCtx = document.getElementById('paymentMethodsChart').getContext('2d');
    new Chart(paymentMethodsCtx, {
        type: 'doughnut',
        data: {
            labels: ['Credit Card', 'Debit Card', 'Digital Wallet', 'Bank Transfer'],
            datasets: [{
                data: [45, 30, 15, 10],
                backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    labels: { color: '#ffffff' }
                }
            }
        }
    });

    // Payment Status Chart
    const paymentStatusCtx = document.getElementById('paymentStatusChart').getContext('2d');
    new Chart(paymentStatusCtx, {
        type: 'bar',
        data: {
            labels: ['Completed', 'Pending', 'Failed', 'Refunded'],
            datasets: [{
                label: 'Count',
                data: [1200, 45, 12, 8],
                backgroundColor: ['#10b981', '#f59e0b', '#ef4444', '#6b7280']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    labels: { color: '#ffffff' }
                }
            },
            scales: {
                x: { ticks: { color: '#ffffff' } },
                y: { ticks: { color: '#ffffff' } }
            }
        }
    });
}

function loadRecentTransactions() {
    // Simulate loading transactions
    const transactions = [
        { id: 'TXN001', user: 'John Doe', amount: '$15.00', method: 'Credit Card', status: 'Completed', date: '2024-12-20' },
        { id: 'TXN002', user: 'Jane Smith', amount: '$12.50', method: 'Digital Wallet', status: 'Completed', date: '2024-12-20' },
        { id: 'TXN003', user: 'Bob Johnson', amount: '$8.00', method: 'Debit Card', status: 'Pending', date: '2024-12-19' },
        { id: 'TXN004', user: 'Alice Brown', amount: '$20.00', method: 'Bank Transfer', status: 'Completed', date: '2024-12-19' },
        { id: 'TXN005', user: 'Charlie Wilson', amount: '$10.00', method: 'Credit Card', status: 'Failed', date: '2024-12-18' }
    ];

    const tbody = document.getElementById('transactionsTable');
    tbody.innerHTML = '';

    transactions.forEach(txn => {
        const row = document.createElement('tr');
        row.className = 'border-b border-gray-700 hover:bg-gray-700/30';
        
        const statusColor = txn.status === 'Completed' ? 'text-green-400' : 
                          txn.status === 'Pending' ? 'text-yellow-400' : 
                          txn.status === 'Failed' ? 'text-red-400' : 'text-gray-400';
        
        row.innerHTML = `
            <td class="py-3 px-4">${txn.id}</td>
            <td class="py-3 px-4">${txn.user}</td>
            <td class="py-3 px-4">${txn.amount}</td>
            <td class="py-3 px-4">${txn.method}</td>
            <td class="py-3 px-4 ${statusColor}">${txn.status}</td>
            <td class="py-3 px-4">${txn.date}</td>
        `;
        tbody.appendChild(row);
    });
}

function generateReport() {
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;
    
    if (!startDate || !endDate) {
        alert('Please select both start and end dates');
        return;
    }
    
    // Simulate report generation
    console.log('Generating report from', startDate, 'to', endDate);
    // Here you would make an API call to generate the report
}

function exportReport() {
    // Simulate PDF export
    console.log('Exporting financial report to PDF');
    // Here you would implement PDF export functionality
}

function refreshReport() {
    // Simulate data refresh
    console.log('Refreshing financial report data');
    // Here you would reload the data from the server
}
</script>

</body>
</html>
