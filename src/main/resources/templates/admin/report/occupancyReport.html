<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ParQHub - Occupancy Report</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Icons -->
    <script src="https://kit.fontawesome.com/4ad8d5ae3f.js" crossorigin="anonymous"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #0a0f1c; }
        .glass {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        .active {
            background: linear-gradient(90deg, #ffb703, #ff6600);
            color: #0a0f1c !important;
            font-weight: bold;
        }
    </style>
</head>
<body class="text-white flex">

<!-- Sidebar -->
<aside class="w-72 h-screen glass flex flex-col fixed">
    <div class="p-6 flex items-center gap-3 border-b border-gray-700">
        <img src="/images/logo.svg" alt="ParQHub" class="h-10">
        <span class="text-2xl font-bold">ParQHub</span>
    </div>
    <nav class="flex-1 p-4 space-y-2">
        <a href="/admin/dashboard" class="flex items-center gap-3 p-3 rounded-lg hover:bg-yellow-400/30 transition"><i class="fas fa-home"></i> Dashboard</a>
        <a href="/admin/tables" class="flex items-center gap-3 p-3 rounded-lg hover:bg-yellow-400/30 transition"><i class="fas fa-table"></i> Table View</a>
        <a href="/admin/parking-viewer" class="flex items-center gap-3 p-3 rounded-lg hover:bg-yellow-400/30 transition"><i class="fas fa-parking"></i> Parking Viewer</a>
        <a href="/admin/reports" class="flex items-center gap-3 p-3 rounded-lg hover:bg-yellow-400/30 transition"><i class="fas fa-chart-bar"></i> Report View</a>
    </nav>
    <div class="p-4 border-t border-gray-700">
        <a th:href="@{/admin/logout}" class="flex items-center gap-3 p-3 rounded-lg hover:bg-red-500/30 text-red-400"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </div>
</aside>

<!-- Main Content -->
<main class="ml-72 w-full p-6">
    <!-- Top bar -->
    <div class="flex justify-between items-center mb-6">
        <div class="flex items-center gap-4">
            <a href="/admin/reports" class="text-yellow-400 hover:text-yellow-300 transition">
                <i class="fas fa-arrow-left text-xl"></i>
            </a>
            <h1 class="text-2xl font-bold">Occupancy Report</h1>
        </div>
        <div class="flex items-center gap-4">
            <button onclick="exportReport()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-400 transition font-semibold">
                <i class="fas fa-download mr-2"></i>Export PDF
            </button>
            <button onclick="refreshReport()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-400 transition font-semibold">
                <i class="fas fa-sync-alt mr-2"></i>Refresh
            </button>
            <span class="text-gray-300">Welcome, <span th:text="${adminName}">Admin</span></span>
        </div>
    </div>

    <!-- Report Period Selection -->
    <div class="glass p-6 rounded-lg mb-6">
        <h2 class="text-xl font-bold mb-4">Report Period</h2>
        <div class="flex gap-4 items-end">
            <div>
                <label for="startDate" class="block text-sm font-medium text-gray-300 mb-2">Start Date</label>
                <input type="date" id="startDate" class="bg-gray-700/50 border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:border-yellow-400">
            </div>
            <div>
                <label for="endDate" class="block text-sm font-medium text-gray-300 mb-2">End Date</label>
                <input type="date" id="endDate" class="bg-gray-700/50 border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:border-yellow-400">
            </div>
            <div>
                <label for="parkingLot" class="block text-sm font-medium text-gray-300 mb-2">Parking Lot</label>
                <select id="parkingLot" class="bg-gray-700/50 border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:border-yellow-400">
                    <option value="">All Lots</option>
                    <option value="1">Colombo - City Center</option>
                    <option value="2">Kandy - Temple Area</option>
                    <option value="3">Galle - Fort Area</option>
                </select>
            </div>
            <button onclick="generateReport()" class="bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-400 transition font-semibold">
                <i class="fas fa-chart-bar mr-2"></i>Generate Report
            </button>
        </div>
    </div>

    <!-- Occupancy Summary -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
        <div class="glass p-6 rounded-lg text-center">
            <div class="text-3xl font-bold text-green-400 mb-2" id="avgOccupancy">85%</div>
            <div class="text-sm text-gray-400">Avg Occupancy</div>
        </div>
        <div class="glass p-6 rounded-lg text-center">
            <div class="text-3xl font-bold text-blue-400 mb-2" id="totalBookings">1,247</div>
            <div class="text-sm text-gray-400">Total Bookings</div>
        </div>
        <div class="glass p-6 rounded-lg text-center">
            <div class="text-3xl font-bold text-purple-400 mb-2" id="peakHours">2-4 PM</div>
            <div class="text-sm text-gray-400">Peak Hours</div>
        </div>
        <div class="glass p-6 rounded-lg text-center">
            <div class="text-3xl font-bold text-yellow-400 mb-2" id="utilizationRate">78%</div>
            <div class="text-sm text-gray-400">Utilization Rate</div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <!-- Hourly Occupancy Chart -->
        <div class="glass p-6 rounded-lg">
            <h3 class="text-lg font-bold mb-4">Hourly Occupancy Pattern</h3>
            <canvas id="hourlyOccupancyChart" width="400" height="200"></canvas>
        </div>

        <!-- Daily Occupancy Chart -->
        <div class="glass p-6 rounded-lg">
            <h3 class="text-lg font-bold mb-4">Daily Occupancy Trend</h3>
            <canvas id="dailyOccupancyChart" width="400" height="200"></canvas>
        </div>
    </div>

    <!-- Parking Lot Performance -->
    <div class="glass p-6 rounded-lg mb-6">
        <h3 class="text-lg font-bold mb-4">Parking Lot Performance</h3>
        <canvas id="lotPerformanceChart" width="800" height="300"></canvas>
    </div>

    <!-- Slot Status Distribution -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <div class="glass p-6 rounded-lg">
            <h3 class="text-lg font-bold mb-4">Current Slot Status</h3>
            <canvas id="slotStatusChart" width="400" height="200"></canvas>
        </div>

        <div class="glass p-6 rounded-lg">
            <h3 class="text-lg font-bold mb-4">Booking Duration Distribution</h3>
            <canvas id="bookingDurationChart" width="400" height="200"></canvas>
        </div>
    </div>

    <!-- Top Performing Lots -->
    <div class="glass p-6 rounded-lg">
        <h3 class="text-lg font-bold mb-4">Top Performing Parking Lots</h3>
        <div class="overflow-x-auto">
            <table class="w-full text-sm">
                <thead>
                    <tr class="border-b border-gray-600">
                        <th class="text-left py-3 px-4">Rank</th>
                        <th class="text-left py-3 px-4">Parking Lot</th>
                        <th class="text-left py-3 px-4">Total Slots</th>
                        <th class="text-left py-3 px-4">Avg Occupancy</th>
                        <th class="text-left py-3 px-4">Revenue</th>
                        <th class="text-left py-3 px-4">Efficiency</th>
                    </tr>
                </thead>
                <tbody id="lotPerformanceTable">
                    <!-- Lot performance data will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>
</main>

<script>
// Initialize charts
document.addEventListener('DOMContentLoaded', function() {
    initializeCharts();
    loadLotPerformance();
    setDefaultDates();
});

function setDefaultDates() {
    const today = new Date();
    const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());
    
    document.getElementById('startDate').value = lastMonth.toISOString().split('T')[0];
    document.getElementById('endDate').value = today.toISOString().split('T')[0];
}

function initializeCharts() {
    // Hourly Occupancy Chart
    const hourlyCtx = document.getElementById('hourlyOccupancyChart').getContext('2d');
    new Chart(hourlyCtx, {
        type: 'line',
        data: {
            labels: ['6AM', '8AM', '10AM', '12PM', '2PM', '4PM', '6PM', '8PM', '10PM'],
            datasets: [{
                label: 'Occupancy %',
                data: [20, 45, 70, 85, 95, 90, 75, 50, 25],
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    labels: { color: '#ffffff' }
                }
            },
            scales: {
                x: { ticks: { color: '#ffffff' } },
                y: { ticks: { color: '#ffffff' } }
            }
        }
    });

    // Daily Occupancy Chart
    const dailyCtx = document.getElementById('dailyOccupancyChart').getContext('2d');
    new Chart(dailyCtx, {
        type: 'bar',
        data: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                label: 'Avg Occupancy %',
                data: [85, 90, 88, 92, 95, 70, 60],
                backgroundColor: '#10b981'
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    labels: { color: '#ffffff' }
                }
            },
            scales: {
                x: { ticks: { color: '#ffffff' } },
                y: { ticks: { color: '#ffffff' } }
            }
        }
    });

    // Lot Performance Chart
    const lotPerformanceCtx = document.getElementById('lotPerformanceChart').getContext('2d');
    new Chart(lotPerformanceCtx, {
        type: 'bar',
        data: {
            labels: ['Colombo Center', 'Kandy Temple', 'Galle Fort', 'Negombo Beach', 'Anuradhapura'],
            datasets: [{
                label: 'Occupancy %',
                data: [92, 88, 85, 78, 82],
                backgroundColor: '#8b5cf6'
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    labels: { color: '#ffffff' }
                }
            },
            scales: {
                x: { ticks: { color: '#ffffff' } },
                y: { ticks: { color: '#ffffff' } }
            }
        }
    });

    // Slot Status Chart
    const slotStatusCtx = document.getElementById('slotStatusChart').getContext('2d');
    new Chart(slotStatusCtx, {
        type: 'doughnut',
        data: {
            labels: ['Available', 'Booked', 'Occupied'],
            datasets: [{
                data: [30, 25, 45],
                backgroundColor: ['#10b981', '#3b82f6', '#ef4444']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    labels: { color: '#ffffff' }
                }
            }
        }
    });

    // Booking Duration Chart
    const bookingDurationCtx = document.getElementById('bookingDurationChart').getContext('2d');
    new Chart(bookingDurationCtx, {
        type: 'pie',
        data: {
            labels: ['1-2 Hours', '2-4 Hours', '4-8 Hours', '8+ Hours'],
            datasets: [{
                data: [35, 40, 20, 5],
                backgroundColor: ['#f59e0b', '#3b82f6', '#10b981', '#ef4444']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    labels: { color: '#ffffff' }
                }
            }
        }
    });
}

function loadLotPerformance() {
    const lotData = [
        { rank: 1, name: 'Colombo - City Center', slots: 100, occupancy: 92, revenue: '$2,450', efficiency: 'Excellent' },
        { rank: 2, name: 'Kandy - Temple Area', slots: 80, occupancy: 88, revenue: '$1,980', efficiency: 'Good' },
        { rank: 3, name: 'Galle - Fort Area', slots: 60, occupancy: 85, revenue: '$1,520', efficiency: 'Good' },
        { rank: 4, name: 'Negombo - Beach Area', slots: 50, occupancy: 78, revenue: '$1,200', efficiency: 'Fair' },
        { rank: 5, name: 'Anuradhapura - Sacred City', slots: 40, occupancy: 82, revenue: '$980', efficiency: 'Good' }
    ];

    const tbody = document.getElementById('lotPerformanceTable');
    tbody.innerHTML = '';

    lotData.forEach(lot => {
        const row = document.createElement('tr');
        row.className = 'border-b border-gray-700 hover:bg-gray-700/30';
        
        const efficiencyColor = lot.efficiency === 'Excellent' ? 'text-green-400' : 
                               lot.efficiency === 'Good' ? 'text-blue-400' : 
                               lot.efficiency === 'Fair' ? 'text-yellow-400' : 'text-gray-400';
        
        row.innerHTML = `
            <td class="py-3 px-4">${lot.rank}</td>
            <td class="py-3 px-4">${lot.name}</td>
            <td class="py-3 px-4">${lot.slots}</td>
            <td class="py-3 px-4">${lot.occupancy}%</td>
            <td class="py-3 px-4">${lot.revenue}</td>
            <td class="py-3 px-4 ${efficiencyColor}">${lot.efficiency}</td>
        `;
        tbody.appendChild(row);
    });
}

function generateReport() {
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;
    const parkingLot = document.getElementById('parkingLot').value;
    
    if (!startDate || !endDate) {
        alert('Please select both start and end dates');
        return;
    }
    
    console.log('Generating occupancy report from', startDate, 'to', endDate, 'for lot:', parkingLot);
}

function exportReport() {
    console.log('Exporting occupancy report to PDF');
}

function refreshReport() {
    console.log('Refreshing occupancy report data');
}
</script>

</body>
</html>
